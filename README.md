# Enhanced Python FEM Tool
![demo](./figs/python-fem-tool-demo.gif)

このリポジトリでは、Pythonで簡易的にFEMを試してみることができます。
基本は参考サイトのアルタカさんのプログラムをベースに、機械設計者が部品を設計する際の強度計算支援ツールとして大幅に拡張しました。

## 主な機能

### 基本機能
- STLファイルからのメッシュ生成
- 固定端と力点のノード設定（GUIクリック操作）
- 有限要素解析実行
- 変形結果の可視化

### エンハンスされた機能 🆕
- **プロジェクト管理**: 解析設定と結果の保存・読み込み
- **材料データベース**: 一般的な材料の物性値を簡単選択
- **基本形状生成**: 直方体、円柱、円筒、L字断面の自動生成
- **面荷重・辺荷重**: 点荷重以外の分布荷重に対応
- **ドキュメント出力**: HTML/PDF形式での解析レポート生成
- **タブ式GUI**: 直感的な操作インターフェース

### 最新の追加機能 ✨
- **パラメトリック解析**: 形状スケールを変化させた最適化解析
- **振動解析**: 固有振動数とモード形状の解析
- **メッシュ表示最適化**: 細かいメッシュでも軽快な動作
- **変形表示スケール**: 変形量を任意倍率で可視化
- **高度な荷重管理**: LoadManagerによる複雑な荷重設定

### パラメトリック解析
X、Y、Z方向のスケールを個別に変更して、最適な形状比率を探索できます：
- 複数の形状バリエーションを自動解析
- 最大応力、安全率、体積比の一括計算
- CSV形式での結果エクスポート
- 個別ケースの詳細表示（変形表示付き）

### 振動解析
固有振動数とモード形状の解析が可能です：
- 指定したモード数での固有値解析
- 各モードの固有振動数計算
- モード形状の3D可視化
- 結果のCSVエクスポート

### メッシュ表示最適化
大規模メッシュでも快適に操作できる軽量化機能：
- メッシュ表示率の調整（10%～100%）
- エッジのみ表示モード
- 最大表示要素数の制限
- インテリジェントな要素選択

### 材料データベース
構造用鋼材（SS400、S45C、SUS304）、アルミニウム合金（A5052、A6061、A7075）、銅合金、樹脂材料、複合材料など、実際の設計で使用される材料の物性値を収録。

### ドキュメント出力
- 解析条件と結果をまとめたレポート
- Google Documentで閲覧可能なHTML形式
- メッシュと変形画像の自動生成
- 最大応力、最大変位、安全率の自動計算

## インストールと実行

### 必要要件
- Python 3.7以上
- NumPy, SciPy, matplotlib
- tkinter（通常Pythonに含まれる）
- tetgen, numpy-stl

### インストール
```bash
git clone https://github.com/hijimasa/python-fem-tool.git
cd python-fem-tool
pip install -r requirements.txt
```

### 実行
```bash
python main.py
```

## 使い方

### 1. 基本的な解析フロー

#### STL読み込み / 形状生成
- **File**タブ: STLファイルの読み込み
- **Geometry**タブ: 基本形状（直方体、円柱等）の自動生成

#### 材料設定
- **Material**タブ: 材料データベースから選択、または手動入力
- ヤング率、ポアソン比、密度、降伏強度の設定

#### 境界条件設定
- **Boundary**タブ: 固定端と荷重の設定
- 点荷重、辺荷重、面荷重の設定が可能
- 3Dビューでの直感的なノード選択

#### 解析実行
- **Analysis**タブ: 通常の有限要素解析
- **Parametric**タブ: パラメトリック解析
- **Vibration**タブ: 振動解析

### 2. 高度な機能

#### パラメトリック解析
1. 基本形状と境界条件を設定
2. **Parametric**タブでスケール範囲を設定
3. 「解析実行」で複数ケースを自動実行
4. 結果テーブルから最適なケースを選択

#### 振動解析
1. 固定端を設定（荷重は不要）
2. **Vibration**タブでモード数を指定
3. 「解析実行」で固有値解析を実行
4. モード形状を個別に表示可能

#### メッシュ表示最適化
1. **Geometry**タブの「表示設定」パネルを使用
2. メッシュ表示率スライダーで軽量化
3. 「エッジのみ表示」で更なる軽量化
4. 最大表示要素数で上限を制御

### 3. 操作方法
- **左クリック**: ノード選択
- **右クリック**: ノード選択解除
- **マウスドラッグ**: 3Dビューの回転
- **マウスホイール**: ズームイン/アウト

### 4. 出力ファイル
- `analysis_result.txt`: 解析結果の詳細
- `*.html`: ドキュメント出力（レポート）
- `*.csv`: パラメトリック/振動解析結果
- `*.json`: プロジェクトファイル

## 技術的詳細

### アーキテクチャ
- **メッシュ分離**: 解析用メッシュと表示用メッシュを分離し、スケール累積問題を解決
- **モジュラー設計**: 各機能を独立したクラスとして実装
- **最適化**: 大規模メッシュ対応の描画軽量化

### サポートされる要素
- 四面体1次要素（C3D4）
- Consistent mass matrix（振動解析）

### 解析機能
- 線形静解析
- 固有値解析（振動）
- von Mises応力計算
- 安全率評価

## トラブルシューティング

### よくある問題
1. **STL読み込みエラー**: ファイルパスに日本語が含まれていないか確認
2. **メッシュ生成失敗**: STLファイルが閉じた形状（manifold）になっているか確認
3. **解析エラー**: 固定端が設定されているか、荷重が適切に設定されているか確認
4. **表示が重い**: メッシュ表示最適化機能を使用

### パフォーマンスの最適化
- メッシュ表示率を下げる（50%程度）
- エッジのみ表示モードを使用
- 最大表示要素数を制限（5000要素程度）

## 開発者向け情報

### 主要クラス
- `EnhancedFEMTool`: メインGUIクラス
- `FEM`: 有限要素解析エンジン
- `LoadManager`: 荷重管理
- `GeometryGenerator`: 基本形状生成
- `MaterialDatabase`: 材料データベース

### 拡張方法
新しい機能を追加する場合は、対応するタブとクラスを追加し、メインクラスから呼び出してください。

## ライセンス
MITライセンスの下で公開されています。

## 参考サイト
- [3次元有限要素法をPythonで実装する(四面体要素)](https://qiita.com/Altaka4128/items/41101c96729b68d7c96f)

## 更新履歴
### v2.0 (最新)
- パラメトリック解析機能追加
- 振動解析機能追加
- メッシュ表示最適化
- 変形表示スケール機能
- メッシュ分離アーキテクチャ

### v1.0
- 基本FEM解析機能
- STL読み込み
- GUI操作